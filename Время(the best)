import sys
from time import strftime

import pygetwindow as pgetw
import tkinter
from tkinter import *
import time
from datetime import datetime
from zoneinfo import ZoneInfo
import ntplib
from datetime import datetime
import customtkinter as ctk
from customtkinter import CTkButton, CTkLabel
import PIL
from PIL import Image, ImageTk


ctk.set_default_color_theme("orange_theme.json")
ctk.set_appearance_mode("system")
apap = pgetw.getWindowsWithTitle("Real time")

realtime = ()
timedate = ()

def rtime():

    global lbl_time

    # Client зачем-то. А это
    client = ntplib.NTPClient()
    try:
        # Запрашиваем время с сервера
        zakaz = client.request('time.google.com')
    except ntplib.NTPException:
        lbl_time.configure(text="Сайт не отвечает")


    # как я понял, устанавливаем переменную и
    # запрашиваем время с ссылки pool.ntp.org

    # Получаем точное время (rtime)
    ttime = datetime.fromtimestamp(zakaz.tx_time)

    # Преобразуем в читаемый формат
    global realtime
    realtime = ttime.strftime("%H:%M:%S")

    # ttime.strftime("%H:%M:%S")


    lbl_time.configure(text=realtime)
    print(f"Реальное время из интернета: {realtime}")

    # Дата теперь:

    try:
        zakazd = client.request("time.google.com")
    except ntplib.NTPException:
        lbl_date.configure(text="Даты нету")

    ddate = datetime.fromtimestamp(zakazd.tx_time)

    global timedate
    timedate = strftime("%d:%m:%y")
    lbl_date.configure(text=timedate)

    print(timedate)












# def exit():
#     sys.exit()








# root.geometry("200x100")
# root.config(bg="Black")
# root.resizable(width=False, height=False)
# root.title("Real TIME:")
# root.iconbitmap("clock.ico")

app = ctk.CTk()
app.geometry("200x100")
app.resizable(width=False, height=False)
app.title("Real time")
app.overrideredirect(False)



# end = Image.open("end.png")
# end = end.resize((20, 20))
# ended = ImageTk.PhotoImage(end)



btn = CTkButton(app,
                text="ВРЕМЯ",
                command=rtime,
                font=("Comic Sans MS", 10),
                width=180)
btn.place(x=10, y=60)


# btn_end = CTkButton(app,
#                     text="",
#                     fg_color="transparent",
#                     border_width=0,
#                     image=ended,
#                     width=20,
#                     command=exit
#                     )
# btn_end.place(x=160, y=10)


lbl_time = CTkLabel(app,
                 text="Нажми кнопку!",
                 font=("Comic Sans MS", 20),
                 width=180)
lbl_time.place(x=10, y=30)

lbl_date = CTkLabel(app,
                    text="Кнопка!",
                    font=("Comic Sans MS", 20),
                    width=180)
lbl_date.place(x=10, y=5)

# btn_close = CTkButton(app,
#                       text="Close",
#                       command=app.iconify)
# btn_close.place(x=10, y=10)



app.mainloop()
